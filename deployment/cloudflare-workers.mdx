---
title: Deploy to Cloudflare Workers
description: Deploy your xmcp server to Cloudflare's global edge network
---

xmcp supports deployment to Cloudflare Workers with a specialized build process that creates a fully-bundled, edge-ready worker.

## Quick Start

### 1. Build for Cloudflare

```bash
xmcp build --cf
```

This generates:
- `worker.js` - Bundled Cloudflare Worker in your project root
- `wrangler.jsonc` - Wrangler configuration (if not already present)

### 2. Test Locally

```bash
npx wrangler dev
```

### 3. Deploy

```bash
npx wrangler deploy
```

## How It Works

The `--cf` flag triggers specialized Cloudflare bundling:

<CodeGroup>

```typescript Build Process
// From: packages/xmcp/src/platforms/build-cloudflare-output.ts

async function buildCloudflareOutput(options = {}) {
  const outputDir = rootDir;
  const buildDir = path.join(rootDir, ".xmcp", "cloudflare");

  // Check if Cloudflare worker build exists
  const sourceFile = path.join(buildDir, "worker.js");
  if (!fs.existsSync(sourceFile)) {
    throw new Error("Cloudflare build output not found. Run: xmcp build --cf");
  }

  // Copy the bundled worker
  const targetFile = path.join(outputDir, "worker.js");
  fs.copyFileSync(sourceFile, targetFile);

  // Generate wrangler config (only if the user doesn't have one already)
  const wranglerTomlPath = path.join(outputDir, "wrangler.toml");
  const wranglerJsoncPath = path.join(outputDir, "wrangler.jsonc");
  if (!fs.existsSync(wranglerTomlPath) && !fs.existsSync(wranglerJsoncPath)) {
    const projectName = getProjectName();
    const wranglerConfig = generateWranglerConfig(projectName);
    fs.writeFileSync(wranglerJsoncPath, wranglerConfig);
  }
}
```

</CodeGroup>

### Generated wrangler.jsonc

```jsonc wrangler.jsonc
{
  "$schema": "node_modules/wrangler/config-schema.json",
  // Wrangler config generated by: xmcp build --cf
  // Docs: https://developers.cloudflare.com/workers/wrangler/configuration/
  "name": "your-project-name",
  "main": "worker.js",
  "compatibility_date": "2026-02-28",
  "compatibility_flags": ["nodejs_compat"],

  // Observability (Workers Logs)
  "observability": {
    "enabled": true
  }

  // Uncomment to add environment variables:
  // "vars": {
  //   "MY_VAR": "my-value"
  // },

  // Uncomment to add KV namespaces:
  // "kv_namespaces": [
  //   { "binding": "MY_KV", "id": "your-kv-namespace-id" }
  // ],

  // Uncomment to add D1 databases:
  // "d1_databases": [
  //   { "binding": "MY_DB", "database_name": "my-database", "database_id": "your-database-id" }
  // ]
}
```

## Development Workflow

For rapid development, use the watch mode:

```bash
xmcp dev --cf
```

This rebuilds `worker.js` whenever your source files change. Run this alongside `wrangler dev`:

```bash
# Terminal 1: Watch and rebuild
xmcp dev --cf

# Terminal 2: Run local worker
npx wrangler dev
```

Or use `concurrently` to run both commands together:

```json package.json
{
  "scripts": {
    "dev": "concurrently \"xmcp dev --cf\" \"npx wrangler dev\"",
    "build": "xmcp build --cf",
    "deploy": "npx wrangler deploy"
  },
  "devDependencies": {
    "concurrently": "^9.2.0",
    "wrangler": "^4.62.0"
  }
}
```

## Complete Example

Here's a real working example from the xmcp repository:

<CodeGroup>

```typescript xmcp.config.ts
import { XmcpConfig } from "xmcp";

const config: XmcpConfig = {
  http: {
    debug: true,
  },
  paths: {
    tools: "./src/tools",
    prompts: false,
    resources: false,
  },
};

export default config;
```

```json package.json
{
  "name": "cloudflare-workers-example",
  "version": "0.0.1",
  "type": "module",
  "scripts": {
    "build": "xmcp build --cf",
    "dev": "concurrently \"xmcp dev --cf\" \"npx wrangler dev\"",
    "deploy": "npx wrangler deploy",
    "preview": "npx wrangler dev"
  },
  "dependencies": {
    "xmcp": "latest",
    "zod": "^3.23.8"
  },
  "devDependencies": {
    "@cloudflare/workers-types": "^4.20241112.0",
    "concurrently": "^9.2.0",
    "wrangler": "^4.62.0"
  }
}
```

```typescript src/tools/hello.ts
import { tool } from "xmcp";
import { z } from "zod";

export default tool({
  name: "hello",
  description: "Say hello to someone",
  parameters: z.object({
    name: z.string().describe("The name to greet"),
  }),
  execute: async ({ name }) => {
    return {
      content: [
        {
          type: "text",
          text: `Hello, ${name}! This is running on Cloudflare Workers.`,
        },
      ],
    };
  },
});
```

</CodeGroup>

## Testing Your Worker

Once `wrangler dev` is running (default port: 8787), test your endpoints:

### Health Check

```bash
curl http://localhost:8787/health
```

### List Tools

```bash
curl -X POST http://localhost:8787/mcp \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -d '{"jsonrpc":"2.0","method":"tools/list","id":1}'
```

### Call a Tool

```bash
curl -X POST http://localhost:8787/mcp \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -d '{"jsonrpc":"2.0","method":"tools/call","params":{"name":"hello","arguments":{"name":"World"}},"id":2}'
```

## Cloudflare-Specific Features

xmcp exports Cloudflare-optimized middleware through the `xmcp/cloudflare` package.

### API Key Authentication

```typescript xmcp.config.ts
import { XmcpConfig } from "xmcp";
import { apiKeyAuthMiddleware } from "xmcp/cloudflare";

const config: XmcpConfig = {
  http: {
    middlewares: [
      apiKeyAuthMiddleware({
        apiKey: "your-secret-key",
        headerName: "x-api-key", // optional, defaults to 'x-api-key'
      }),
    ],
  },
};

export default config;
```

<CodeGroup>

```typescript Static API Key
// From: packages/xmcp/src/runtime/platforms/cloudflare/middlewares/api-key.ts

export function cloudflareApiKeyAuthMiddleware(
  config: { apiKey: string; headerName?: string }
): WebMiddleware {
  const headerName = config.headerName ?? "x-api-key";
  
  return async (request) => {
    const apiKeyHeader = request.headers.get(headerName);
    if (!apiKeyHeader || apiKeyHeader !== config.apiKey) {
      return new Response(
        JSON.stringify({ error: "Unauthorized: Missing or invalid API key" }),
        { status: 401, headers: { "Content-Type": "application/json" } }
      );
    }
    return; // Allow request to continue
  };
}
```

```typescript Custom Validation
// Custom validation function
apiKeyAuthMiddleware({
  validateApiKey: async (key: string) => {
    // Check against database, KV store, etc.
    return key === await env.KV.get("VALID_API_KEY");
  },
})
```

</CodeGroup>

### JWT Authentication

```typescript xmcp.config.ts
import { XmcpConfig } from "xmcp";
import { jwtAuthMiddleware } from "xmcp/cloudflare";

const config: XmcpConfig = {
  http: {
    middlewares: [
      jwtAuthMiddleware({
        secret: "your-jwt-secret",
        algorithms: ["HS256"],
        issuer: "your-issuer",
        audience: "your-audience",
      }),
    ],
  },
};

export default config;
```

<CodeGroup>

```typescript JWT Middleware Implementation
// From: packages/xmcp/src/runtime/platforms/cloudflare/middlewares/jwt.ts

import { jwtVerify, importJWK, importSPKI, importX509 } from "jose";

export function cloudflareJwtAuthMiddleware(
  config: CloudflareJWTAuthMiddlewareConfig
): WebMiddleware {
  return async (request) => {
    const authHeader = request.headers.get("authorization");
    const token = extractBearerToken(authHeader);
    
    if (!token) {
      return jsonUnauthorized(
        "Unauthorized: Missing or malformed Authorization header"
      );
    }

    try {
      await verifyJwt(token, config);
      return; // Valid token
    } catch {
      return jsonUnauthorized("Unauthorized: Invalid or expired token");
    }
  };
}
```

```typescript Configuration Options
export type CloudflareJWTAuthMiddlewareConfig = {
  secret: string;              // JWT secret or public key
  algorithms?: string[];       // e.g., ["HS256", "RS256"]
  audience?: string | string[]; // Expected audience
  issuer?: string;             // Expected issuer
  subject?: string;            // Expected subject
  clockTolerance?: number | string; // Clock skew tolerance
  maxAge?: string | number;    // Max token age
};
```

</CodeGroup>

The JWT middleware supports multiple secret formats:
- **Plain string**: HMAC secrets (HS256, HS384, HS512)
- **JWK**: JSON Web Key format
- **PEM**: Public keys (RS256, ES256, etc.)
- **X.509**: Certificate format

## Environment Variables

Configure secrets and environment variables in `wrangler.jsonc`:

```jsonc wrangler.jsonc
{
  "name": "my-xmcp-worker",
  "main": "worker.js",
  "compatibility_date": "2026-02-28",
  "compatibility_flags": ["nodejs_compat"],
  
  "vars": {
    "ENVIRONMENT": "production"
  },
  
  // For secrets, use: wrangler secret put API_KEY
  // Then access via: env.API_KEY in your middleware
}
```

Set secrets using Wrangler CLI:

```bash
wrangler secret put API_KEY
wrangler secret put JWT_SECRET
```

<Warning>
  Never commit secrets to `wrangler.jsonc`. Use `wrangler secret put` or environment-specific configurations.
</Warning>

## Cloudflare Bindings

Access Cloudflare platform features:

### KV Storage

```jsonc wrangler.jsonc
{
  "kv_namespaces": [
    { "binding": "MY_KV", "id": "your-namespace-id" }
  ]
}
```

### D1 Database

```jsonc wrangler.jsonc
{
  "d1_databases": [
    { 
      "binding": "DB",
      "database_name": "my-database",
      "database_id": "your-database-id"
    }
  ]
}
```

### R2 Storage

```jsonc wrangler.jsonc
{
  "r2_buckets": [
    { "binding": "MY_BUCKET", "bucket_name": "my-bucket" }
  ]
}
```

## Limitations

Cloudflare Workers have some constraints:

- **CPU Time**: 50ms on free plan, 30s on paid
- **Memory**: 128 MB
- **Script Size**: 1 MB compressed, 10 MB uncompressed
- **No Filesystem**: Use KV, R2, or D1 for persistence

The `--cf` build process handles these by:
- Bundling all dependencies into a single file
- Inlining React component bundles at compile time
- Using only Web APIs (no Node.js runtime dependencies)
- Polyfilling necessary Node.js APIs

## Troubleshooting

### "nodejs_compat" Required

If you see errors about Node.js APIs, ensure your `wrangler.jsonc` includes:

```jsonc
"compatibility_flags": ["nodejs_compat"]
```

### Build Output Not Found

If you see:

```
Cloudflare build output not found. Run: xmcp build --cf
```

Ensure you're running `xmcp build --cf`, not just `xmcp build`.

### Worker Too Large

If your worker exceeds size limits:
1. Review dependenciesâ€”remove unused packages
2. Use Cloudflare bindings (KV, D1) instead of bundling data
3. Enable code splitting if possible

## Next Steps

<CardGroup cols={2}>
  <Card title="Vercel Deployment" icon="triangle" href="/deployment/vercel">
    Deploy to Vercel instead
  </Card>
  <Card title="Self-Hosting" icon="server" href="/deployment/self-hosting">
    Run on your own infrastructure
  </Card>
  <Card title="Middleware" icon="shield" href="/api/types/middleware">
    Add custom middleware
  </Card>
  <Card title="Configuration" icon="gear" href="/api/configuration/overview">
    Configure your xmcp server
  </Card>
</CardGroup>
